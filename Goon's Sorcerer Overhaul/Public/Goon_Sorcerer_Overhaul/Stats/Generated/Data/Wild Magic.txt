// ==================================== Wild Magic ====================================
// Bug Fix: "WILD_MAGIC_GUARANTEED" is no longer referenced as a status in the conditions.
// Changes: Added proper support for the "SORCERER_WILD_MAGIC_SUPRESSED" tag that prevents Wild Magic surges and is unused in vanilla. When the entity has it alongside the "SORCERER_WILD_MAGIC_GUARANTEED" tag they cancel each other out.

new entry "WildMagic"
type "PassiveData"
using "WildMagic"
// Wild Magic
// data "DisplayName" "h184ab785gdae3g4b7ega249ge43291707925;1"
// Unruly magic sparks and fizzes through your veins. &lt;br&gt;&lt;br&gt;For sorcerers, each time you cast a spell of Level 1 or higher, your magic might surge and trigger a random magical effect.&lt;br&gt;&lt;br&gt;For barbarians, each time you rage a random magical effect will trigger.
// data "Description" "h63415200gb6c7g41c2g9d2dg8a0341e5afe3;1"
// data "Icon" "PassiveFeature_WildMagicSurge"
// data "Properties" "Highlighted"
// data "StatsFunctorContext" "OnCast"
// data "Conditions" "not IsCantrip() and HasSpellFlag(SpellFlags.Spell)"
data "Conditions" "not IsCantrip() and HasSpellFlag(SpellFlags.Spell) and (not Tagged('SORCERER_WILD_MAGIC_SUPRESSED', context.Source) or Tagged('SORCERER_WILD_MAGIC_GUARANTEED', context.Source))"
// data "StatsFunctors" "IF(Tagged('SORCERER_WILD_MAGIC_GUARANTEED', context.Source)):TriggerRandomCast(1,,WildMagic);IF(HasStatus('TIDES_OF_CHAOS',context.Source) and not Tagged('SORCERER_WILD_MAGIC_GUARANTEED', context.Source)):TriggerRandomCast(11,,WildMagic,WildMagicTurn);IF(not HasStatus('TIDES_OF_CHAOS',context.Source) and not (HasStatus('WILD_MAGIC_GUARANTEED',context.Source) or Tagged('SORCERER_WILD_MAGIC_SUPRESSED', context.Source))):TriggerRandomCast(20,,WildMagic,WildMagicTurn);IF(HasStatus('TIDES_OF_CHAOS',context.Source)):RemoveStatus(SELF,TIDES_OF_CHAOS)"
data "StatsFunctors" "IF(Tagged('SORCERER_WILD_MAGIC_GUARANTEED', context.Source) and not Tagged('SORCERER_WILD_MAGIC_SUPRESSED', context.Source)):TriggerRandomCast(1,,WildMagic);IF(HasStatus('TIDES_OF_CHAOS',context.Source) and ((not Tagged('SORCERER_WILD_MAGIC_GUARANTEED', context.Source) and not Tagged('SORCERER_WILD_MAGIC_SUPRESSED', context.Source)) or (Tagged('SORCERER_WILD_MAGIC_GUARANTEED', context.Source) and Tagged('SORCERER_WILD_MAGIC_SUPRESSED', context.Source)))):TriggerRandomCast(11,,WildMagic,WildMagicTurn);IF(not HasStatus('TIDES_OF_CHAOS',context.Source) and ((not Tagged('SORCERER_WILD_MAGIC_GUARANTEED', context.Source) and not Tagged('SORCERER_WILD_MAGIC_SUPRESSED', context.Source)) or (Tagged('SORCERER_WILD_MAGIC_GUARANTEED', context.Source) and Tagged('SORCERER_WILD_MAGIC_SUPRESSED', context.Source)))):TriggerRandomCast(20,,WildMagic,WildMagicTurn);IF(HasStatus('TIDES_OF_CHAOS',context.Source)):RemoveStatus(SELF,TIDES_OF_CHAOS)"
